<%- include("./header.html") %>

<section style="max-width:1000px; margin:3em auto; padding:1.5em;">
  <h2 style="color:var(--primary); text-align:center; margin-bottom:1em;">
    ğŸ§‘â€ğŸŒ¾â€¯Beefâ€¯Inventoryâ€¯Management
  </h2>

  <% if (message) { %>
    <div style="
      background:#d8f3dc;
      border:1px solid #b7e4c7;
      color:#1b4332;
      padding:0.7em 1em;
      border-radius:6px;
      margin-bottom:1em;
      text-align:center;">
      <%= message %>
    </div>
  <% } %>

  <form id="itemsForm" method="POST" action="/admin-beef">
    <input type="hidden" id="itemsJSON" name="itemsJSON">

    <!-- Inventory Table -->
    <table id="adminTable" style="
      width:100%;
      border-collapse:collapse;
      background:white;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);">
      <thead style="background-color:var(--primary); color:white;">
        <tr>
          <th style="padding:0.5em;">â‡…</th>
          <th style="padding:0.5em;">Itemâ€¯Name</th>
          <th style="padding:0.5em;">Weightâ€¯Rangeâ€¯(lbs)</th>
          <th style="padding:0.5em;">Priceâ€¯($/lb)</th>
          <th style="padding:0.5em;">Quantity</th>
          <th style="padding:0.5em;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% items.forEach(item => { %>
          <tr draggable="true">
            <td style="text-align:center; cursor:grab;">â˜°</td>
            <td><input type="text" value="<%= item.name %>" style="width:95%;"></td>
            <td><input type="text" value="<%= item.weightRange %>" style="width:95%;"></td>
            <td><input type="number" step="0.01" value="<%= item.price %>" style="width:90%;"></td>
            <td><input type="number" value="<%= item.quantity %>" style="width:90%;"></td>
            <td>
              <button type="button" onclick="removeRow(this)"
                style="background:#d00000;color:#fff;border:none;border-radius:4px;
                       padding:0.3em 0.6em;">ğŸ—‘</button>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <!-- Action Buttons -->
    <div style="margin-top:1em; text-align:center;">
      <button type="button" id="addRowBtn" style="
        background:var(--accent);
        color:white;
        border:none;
        border-radius:5px;
        padding:0.5em 1em;
        margin-right:0.5em;">
        â•â€¯Addâ€¯Item
      </button>

      <button type="submit" style="
        background:var(--primary);
        color:white;
        border:none;
        border-radius:5px;
        padding:0.5em 1.4em;">
        ğŸ’¾â€¯Saveâ€¯Changes
      </button>
    </div>
  </form>
</section>

<script>
  const tableBody = document.querySelector('#adminTable tbody');
  const addRowBtn  = document.getElementById('addRowBtn');
  const form       = document.getElementById('itemsForm');
  const hiddenInput= document.getElementById('itemsJSON');

  // ----- Add Rows -----
  addRowBtn.addEventListener('click', () => {
    const row = document.createElement('tr');
    row.setAttribute('draggable', 'true');
    row.innerHTML = `
      <td style="text-align:center; cursor:grab;">â˜°</td>
      <td><input type="text" placeholder="Item name" style="width:95%;"></td>
      <td><input type="text" placeholder="Weight range (lbs)" style="width:95%;"></td>
      <td><input type="number" step="0.01" placeholder="Price per lb" style="width:90%;"></td>
      <td><input type="number" placeholder="Qty" style="width:90%;"></td>
      <td>
        <button type="button" onclick="removeRow(this)"
          style="background:#d00000;color:#fff;border:none;border-radius:4px;
                 padding:0.3em 0.6em;">ğŸ—‘</button>
      </td>`;
    tableBody.appendChild(row);
  });

  // ----- Remove Rows -----
  function removeRow(btn) {
    btn.closest('tr').remove();
  }

  // ----- Drag-and-drop Reordering -----
  let draggedRow = null;

  tableBody.addEventListener('dragstart', e => {
    draggedRow = e.target.closest('tr');
    e.dataTransfer.effectAllowed = 'move';
    draggedRow.style.opacity = '0.5';
  });

  tableBody.addEventListener('dragend', () => {
    if (draggedRow) draggedRow.style.opacity = '1';
    draggedRow = null;
  });

  tableBody.addEventListener('dragover', e => {
    e.preventDefault();
    const target = e.target.closest('tr');
    if (!target || target === draggedRow) return;
    const rect = target.getBoundingClientRect();
    const halfway = rect.top + rect.height / 2;
    if (e.clientY > halfway) target.after(draggedRow);
    else target.before(draggedRow);
  });

  // ----- Save (collect ordered data) -----
  form.addEventListener('submit', e => {
    const rows  = tableBody.querySelectorAll('tr');
    const items = [];

    rows.forEach(row => {
      const inputs = row.querySelectorAll('input');
      const [name, weightRange, price, quantity] = Array.from(inputs).map(i => i.value.trim());
      if (name) items.push({ name, weightRange, price, quantity });
    });

    hiddenInput.value = JSON.stringify(items);
  });
</script>

<%- include("./footer.html") %>